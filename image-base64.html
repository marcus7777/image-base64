<link rel="import" href="../polymer/polymer.html">
<script src="../pica/dist/pica.js"></script>
<!--
`<image-base64></image-base64>` resizing and convert images to base64
@demo demo.html
-->

<dom-module id="image-base64">
  <template>
    <canvas id="canvas" hidden width="{{_width}}"></canvas>
  </template>
</dom-module>
<script>
  Polymer({
    is: "image-base64",
    properties: {
      url: {type:String, observer:"load"},
      width: {type: Number,value: 100},
			_width: {computed:"getWidth(width)"},
      background: {type: String, value: "#FFF"},
      scalingUp: {value: false},
      base64: {notify: true}
    },
		getWidth: function(width) {
			if (width < 10) {
			  console.log("Small is dangerous, I'm upping your value to 10")
				return 10
			} else {
				return width
			}
		},
    load: function(url) {
      var that = this
      var img = new Image()
      img.setAttribute('crossOrigin', 'anonymous')
      img.onload = function () {
        if (img.width > that.$.canvas.width || that.scalingUp) {
          that.$.canvas.height = that.$.canvas.width * (img.height / img.width)
        } else {// to avoid scaling up
          that.$.canvas.height = img.height
          that.$.canvas.width = img.width
        }
	window.pica.resizeCanvas(img, that.$.canvas, {alpha: true},function() {
          that.base64 = that.$.canvas.toDataURL("image/png")
	})
      }
      img.src = url
    }
  })
</script>

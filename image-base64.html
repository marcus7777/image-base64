<link rel="import" href="../polymer/polymer.html">
<!--
`<image-base64></image-base64>` resizing and convert images to base64
@demo demo.html
-->

<dom-module id="image-base64">
  <template>
    <canvas id="canvas" hidden width="{{width}}"></canvas>
  </template>
</dom-module>
<script>
  var that, img, ctx
  Polymer({
    is: "image-base64",
    properties: {
      url: {type:String, observer:"load"},
      width: {type: Number,value: 100},
      base64: {
        notify: true
      }
    },
    load: function(url) {
      that = this
      img = new Image()
      img.setAttribute('crossOrigin', 'anonymous')
      img.onload = function () {
        that.$.canvas.height = that.$.canvas.width * (img.height / img.width)
        var octx = that.$.canvas.getContext('2d')
        octx.drawImage(img, 0, 0, that.$.canvas.width, that.$.canvas.height)
        that.base64 = that.$.canvas.toDataURL("image/jpeg")
      }
      img.src = url
    }
  })
</script>
